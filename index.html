<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>å‡ºå‹¤ç³»çµ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

  <style>
    #nowTime {
      background: #000;
      color: #fff;
      font-size: 2rem;
      text-align: center;
      padding: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark">
  <div class="container-fluid">
    <span class="navbar-brand">å‡ºå‹¤ç³»çµ±</span>
  </div>
</nav>

<!-- ç¾åœ¨æ™‚é–“ -->
<div id="nowTime"></div>

<div class="container mt-3">

  <!-- åŸºæœ¬è³‡æ–™ -->
  <div class="row g-2">
    <div class="col-md-4">
      <input id="jobTitle" class="form-control" placeholder="è·ç¨±">
    </div>
    <div class="col-md-4">
      <input id="userName" class="form-control" placeholder="å§“å">
    </div>
    <div class="col-md-4">
      <select id="workType" class="form-select">
        <option value="">è«‹é¸æ“‡é¡å‹</option>
        <option value="assist">å”å‹¤ï¼ˆéœ€ GPSã€ç°½åˆ°ç°½é€€ï¼‰</option>
        <option value="training">å¸¸å¹´è¨“ç·´ï¼ˆéœ€ GPSã€åªç°½åˆ°ï¼‰</option>
        <option value="duty">å…¬å·®å‹¤å‹™ï¼ˆä¸ç”¨ GPSã€ç°½åˆ°ç°½é€€ï¼‰</option>
      </select>
    </div>
  </div>

  <!-- æ™‚é–“ -->
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <input type="date" id="checkInDate" class="form-control">
    </div>
    <div class="col-md-3">
      <input type="time" id="checkInTime" class="form-control">
    </div>
    <div class="col-md-3">
      <input type="date" id="checkOutDate" class="form-control">
    </div>
    <div class="col-md-3">
      <input type="time" id="checkOutTime" class="form-control">
    </div>
  </div>

  <!-- å·¥ä½œå…§å®¹ -->
  <div class="mt-2">
    <textarea id="workContent" class="form-control" rows="2" placeholder="å·¥ä½œå…§å®¹"></textarea>
  </div>

  <!-- æŒ‰éˆ• -->
  <div class="mt-3 d-flex gap-2">
    <button id="btnCheckIn" class="btn btn-success">ç°½åˆ°</button>
    <button id="btnCheckOut" class="btn btn-danger">ç°½é€€</button>
  </div>
</div>

<script>
const apiUrl = 'ğŸ‘‰è²¼ä¸Šä½ çš„ GAS Web App URLğŸ‘ˆ';

function updateNowTime() {
  const now = new Date();
  $('#nowTime').text(now.toLocaleString());
}

setInterval(updateNowTime, 1000);
updateNowTime();

function checkGpsIfNeeded(workType) {
  if (workType === 'duty') return Promise.resolve(true);

  return new Promise((resolve, reject) => {
    navigator.geolocation.getCurrentPosition(
      () => resolve(true),
      () => reject('GPS å–å¾—å¤±æ•—')
    );
  });
}

function sendData() {
  const data = {
    jobTitle: $('#jobTitle').val(),
    userName: $('#userName').val(),
    checkInDate: $('#checkInDate').val(),
    checkInTime: $('#checkInTime').val(),
    checkOutDate: $('#checkOutDate').val(),
    checkOutTime: $('#checkOutTime').val(),
    workContent: $('#workContent').val()
  };

  $.ajax({
    url: apiUrl,
    method: 'POST',
    contentType: 'application/json',
    data: JSON.stringify(data),
    success: () => alert('é€å‡ºæˆåŠŸ'),
    error: () => alert('é€å‡ºå¤±æ•—')
  });
}

$('#btnCheckIn').on('click', function () {
  const workType = $('#workType').val();

  checkGpsIfNeeded(workType)
    .then(sendData)
    .catch(msg => alert(msg));
});
</script>

</body>
</html>
