<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>出勤打卡系統</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

  <style>
    .time-box {
      background: #000;
      color: #fff;
      font-size: 32px;
      text-align: center;
      padding: 12px;
      font-weight: bold;
    }
  </style>
</head>

<body>

<!-- 第一行 Navbar -->
<nav class="navbar navbar-dark bg-dark">
  <div class="container-fluid">
    <span class="navbar-brand">出勤打卡系統</span>
  </div>
</nav>

<!-- 第二行 時間 -->
<div class="time-box" id="nowTime"></div>

<!-- 第三行 表單 -->
<div class="container mt-3">

  <div class="row g-2">
    <div class="col-md-3">
      <label class="form-label">職稱</label>
      <select class="form-select" id="titleSelect"></select>
    </div>

    <div class="col-md-3">
      <label class="form-label">姓名</label>
      <select class="form-select" id="nameSelect"></select>
    </div>

    <div class="col-md-3">
      <label class="form-label">狀態</label>
      <select class="form-select" id="workType">
        <option value="duty">協勤</option>
        <option value="training">常年訓練</option>
        <option value="task">公差勤務</option>
      </select>
    </div>
  </div>

  <hr>

  <div class="row g-2">
    <div class="col-md-3">
      <label>簽到日期</label>
      <input type="date" id="signInDate" class="form-control">
    </div>
    <div class="col-md-3">
      <label>簽到時間</label>
      <input type="time" id="signInTime" class="form-control">
    </div>
    <div class="col-md-3">
      <label>簽退日期</label>
      <input type="date" id="signOutDate" class="form-control">
    </div>
    <div class="col-md-3">
      <label>簽退時間</label>
      <input type="time" id="signOutTime" class="form-control">
    </div>
  </div>

  <div class="mt-3">
    <label>工作內容</label>
    <textarea id="workContent" class="form-control"></textarea>
  </div>

  <div class="mt-3">
    <button class="btn btn-success" id="submitBtn">送出打卡</button>
  </div>

</div>

<script>
const apiUrl = '你的 GAS Web App URL';

function updateClock() {
  const now = new Date();
  $('#nowTime').text(now.toLocaleString());
}

function setNowToInputs() {
  const now = new Date();
  $('#signInDate').val(now.toISOString().slice(0,10));
  $('#signInTime').val(now.toTimeString().slice(0,5));
}

function loadPeople() {
  $.get(apiUrl + '?action=getPeople', function (list) {
    $('#titleSelect').empty();
    $('#nameSelect').empty();

    list.forEach(p => {
      $('#titleSelect').append(`<option>${p.title}</option>`);
      $('#nameSelect').append(`<option>${p.name}</option>`);
    });
  }, 'json');
}

$('#submitBtn').on('click', function () {
  const payload = {
    title: $('#titleSelect').val(),
    name: $('#nameSelect').val(),
    signInDate: $('#signInDate').val(),
    signInTime: $('#signInTime').val(),
    signOutDate: $('#signOutDate').val(),
    signOutTime: $('#signOutTime').val(),
    workContent: $('#workContent').val()
  };

  $.ajax({
    url: apiUrl,
    method: 'POST',
    contentType: 'application/json',
    data: JSON.stringify(payload),
    success: () => alert('打卡成功')
  });
});

setInterval(updateClock, 1000);
updateClock();
setNowToInputs();
loadPeople();
</script>

</body>
</html>
